<!DOCTYPE html>
<html>

    <head>
        <title>TheKarte</title>
        <style>
        body {
            margin: 0px;
        }

        #theKarteMap {
            width: 100%;
            height: 100%;
            position: absolute;
        }

        #theKarteFeedback {
            box-sizing: border-box;

            width: 100%;
            height: 100%;
            position: absolute;

            z-index: 1;
            opacity: 1;

            pointer-events: none;
        }

        @keyframes feedbackAnimation {
            0%   {opacity: 0}
            50%  {opacity: 1}
            100% {opacity: 0}
        }

        .feedbackOk {
            animation-name: feedbackAnimation;
            animation-duration: 1s;
            animation-fill-mode: forwards;

            border: 0.25em solid;
            border-image: radial-gradient(DeepSkyBlue, SkyBlue) 1;
        }

        .feedbackError {
            animation-name: feedbackAnimation;
            animation-duration: 1s;
            animation-fill-mode: forwards;

            border: 0.25em solid;
            border-image: radial-gradient(DeepPink, Pink) 1;
        }

        </style>

        <script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.1.3/build/ol.js"></script>
        <link rel="stylesheet" href="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.1.3/css/ol.css">

        <script src="src/MenuActionAbstract.js"></script>
        <script src="src/MenuActionDrop.js"></script>
        <script src="src/MenuActionFeature.js"></script>
        <script src="src/MenuActionExport.js"></script>
        <script src="src/MenuActionHelp.js"></script>
        <script src="src/MenuActionLayer.js"></script>
        <script src="src/MenuActionView.js"></script>
        <script src="src/KeyboardMenu.js"></script>
        <script src="src/AutomaticStylerFactory.js"></script>
        <script src="src/DropHandler.js"></script>
        <script src="src/TheKarte.js"></script>
    </head>

    <script>
    var theKarte;

    function TheKarteLoad() {
        theKarte = new TheKarte();

        dropHandler = new DropHandler(theKarte);

        var keyboardMenu = new KeyboardMenu(
            new Map([
                //show menu structure
                ['h', new MenuActionHelp(theKarte)],

                //Settings mode
                ['s', new Map([
                    ['f', new MenuActionViewPerformance(theKarte, true)],
                    ['p', new MenuActionViewPerformance(theKarte, false)]
                ])],

                //Export mode
                ['e', new Map([
                    ['a', new MenuActionExportKML(theKarte, true)],
                    ['c', new MenuActionExportKML(theKarte, false)],
                ])],

                //Select active layer
                ['l', new MenuActionLayerSelect(theKarte)],

                //Insert mode
                ['i', new Map([
                    ['l', new MenuActionLayerAdd(theKarte)],
                    ['s', new MenuActionFeatureAdd(theKarte, 'Point')],
                    ['p', new MenuActionFeatureAdd(theKarte, 'Polygon')],
                    ['c', new MenuActionFeatureAdd(theKarte, 'Circle')]
                ])],

                ['m', new MenuActionFeatureModify(theKarte)],

                ['f', new Map([
                    ['i', new MenuActionFeatureFilter(theKarte, true)],
                    ['o', new MenuActionFeatureFilter(theKarte, false)]
                ])],

                //Delete mode
                ['d', new Map([
                    ['l', new MenuActionLayerDelete(theKarte)],
                    ['f', new MenuActionFeatureDelete(theKarte)]
                ])],

                //Drop mode
                ['w', new Map([
                    ['g', new MenuActionDrop(theKarte, dropHandler, 'geo')],
                    ['s', new MenuActionDrop(theKarte, dropHandler, 'style')],
                ])],

                //View mode
                ['v', new Map([
                    ['e', new MenuActionViewExtent(theKarte)],
                    ['t', new Map([
                        //Change tile layer
                        ['o', new MenuActionViewTile(theKarte, new ol.source.OSM())],
                        ['a', new MenuActionViewTile(theKarte, new ol.source.XYZ({
                            attributions: 'Tiles © <a href="https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer">ArcGIS</a>',
                            url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}'
                        }))],
                        ['g', new MenuActionViewTile(theKarte, new ol.source.TileImage({
                            attributions: 'Tiles  © <a href="https://www.google.com/permissions/geoguidelines/">Google</a>',
                            url: 'http://maps.google.com/maps/vt?pb=!1m5!1m4!1i{z}!2i{x}!3i{y}!4i256!2m3!1e0!2sm!3i375060738!3m9!2spl!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!4e0'
                        }))]
                    ])],
                    ['c', new MenuActionViewClusterToggle(theKarte)]
                ])]
            ])
        );

        var theKarte_MapElement = document.createElement("div");
        theKarte_MapElement.id = "theKarteMap";
        document.body.append(theKarte_MapElement);

        var theKarte_FeedbackElement = document.createElement("div");
        theKarte_FeedbackElement.id = "theKarteFeedback";
        document.body.append(theKarte_FeedbackElement);

        var userFeedbackCallback = function(isOk) {
            theKarte_FeedbackElement.classList.remove("feedbackOk");
            theKarte_FeedbackElement.classList.remove("feedbackError");
            void theKarte_FeedbackElement.offsetWidth;
            theKarte_FeedbackElement.className = isOk ? "feedbackOk" : "feedbackError";
        }.bind(this);

        theKarte.setup(keyboardMenu, dropHandler, userFeedbackCallback, theKarte_MapElement, window);

        window.onbeforeunload = function(event) {
            var text = "Do want to reload/close this application? All data will be lost.";
            event.returnValue = text;
            return text;
        };
    }

    </script>

    <body onload="TheKarteLoad()">
    </body>

</html>
